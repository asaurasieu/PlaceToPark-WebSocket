<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Place To Park</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f0f2f5;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
      }
      .header {
        background-color: #ffffff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }
      .stats {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        margin-bottom: 20px;
      }
      .stat-box {
        background-color: #ffffff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        text-align: center;
      }
      .stat-value {
        font-size: 24px;
        font-weight: bold;
        color: #1a73e8;
        margin-bottom: 5px;
      }
      .stat-label {
        color: #666;
      }
      .spots-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 20px;
      }
      .spot {
        background-color: #ffffff;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .spot-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }
      .spot-id {
        font-weight: bold;
        font-size: 16px;
      }
      .status {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 14px;
      }
      .status.occupied {
        background-color: #ffebee;
        color: #c62828;
      }
      .status.empty {
        background-color: #e8f5e9;
        color: #2e7d32;
      }
      .spot-details {
        font-size: 14px;
        color: #666;
      }
      .connection-status {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 8px 16px;
        border-radius: 4px;
        font-size: 14px;
      }
      .connection-status.connected {
        background-color: #e8f5e9;
        color: #2e7d32;
      }
      .connection-status.disconnected {
        background-color: #ffebee;
        color: #c62828;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Parking Spot Detection System</h1>
      </div>

      <div class="connection-status disconnected" id="connectionStatus">
        Disconnected
      </div>

      <div class="stats">
        <div class="stat-box">
          <div class="stat-value" id="totalSpots">-</div>
          <div class="stat-label">Total Spots</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="availableSpots">-</div>
          <div class="stat-label">Available Spots</div>
        </div>
        <div class="stat-box">
          <div class="stat-value" id="detectionRate">-</div>
          <div class="stat-label">Detection Rate</div>
        </div>
      </div>

      <div class="spots-grid" id="spotsGrid"></div>
    </div>

    <script>
      let ws = null;
      const spotsGrid = document.getElementById("spotsGrid");
      const connectionStatus = document.getElementById("connectionStatus");

      function updateStats(data) {
        document.getElementById("totalSpots").textContent = data.total_spots;
        document.getElementById("availableSpots").textContent =
          data.total_spots - data.occupied_spots;
        document.getElementById("detectionRate").textContent =
          data.detection_rate;
      }

      function updateSpots(spots) {
        spotsGrid.innerHTML = "";
        spots.forEach((spot) => {
          const spotElement = document.createElement("div");
          spotElement.className = "spot";
          spotElement.innerHTML = `
            <div class="spot-header">
              <span class="spot-id">Spot ${spot.id}</span>
              <span class="status ${spot.occupied ? "occupied" : "empty"}">
                ${spot.occupied ? "Occupied" : "Empty"}
              </span>
            </div>
            <div class="spot-details">
              Available: ${spot.available ? "Yes" : "No"}
            </div>
          `;
          spotsGrid.appendChild(spotElement);
        });
      }

      function connect() {
        ws = new WebSocket("ws://localhost:8765");

        ws.onopen = () => {
          connectionStatus.textContent = "Connected";
          connectionStatus.classList.remove("disconnected");
          connectionStatus.classList.add("connected");
        };

        ws.onclose = () => {
          connectionStatus.textContent = "Disconnected";
          connectionStatus.classList.remove("connected");
          connectionStatus.classList.add("disconnected");
          setTimeout(connect, 5000);
        };

        ws.onerror = (error) => {
          console.error("WebSocket error:", error);
        };

        ws.onmessage = (event) => {
          const data = JSON.parse(event.data);
          if (data.type === "session_start") {
            console.log("Session started:", data.timestamp);
            return;
          }
          updateStats(data);
          updateSpots(data.spots);
        };
      }

      connect();
    </script>
  </body>
</html>
